<template>
    <template if:true={spinnerInit}>
        <div class="lightning-spinner">
            <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
        </div>
    </template>

    <template if:true={productsOp}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="Productos de la OP" icon-name="utility:cart" class="final-message">
                    <div class="calendar-table">
                        <template if:true={products}>
                            <table>
                                <thead id="product-body">
                                    <tr>
                                        <th class="td-font-samall">Codigo</th>
                                        <th class="td-font-samall">Descripcion</th>
                                        <th class="td-font-samall">Cant</th>
                                        <th class="td-font-samall">Url</th>
                                    </tr>
                                </thead>
                                <tbody class="product-dates">
                                    <template for:each={products} for:item="product">
                                        <tr key={product.Id}>
                                            <td class="td-font-samall">{product.ProductCode}</td>
                                            <td class="td-align-left">{product.Product2.Description}</td>
                                            <td>{product.Quantity}</td>
                                            <td class="td-font-samall"><a href={product.Product2.DisplayUrl}
                                                    target="_blank">Ver</a></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                    <div class="content-btn-lower">
                        <lightning-button label="Calendario con Fechas Disponibles" onclick={nextScreen}
                            class="btn-lower"></lightning-button>
                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={errorNoListaFactu}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="NO Lista Facturar" class="lc-listo-facturar-false">
                    <div class="btn-close-modal">
                        <lightning-button label="❌" onclick={closeModal}></lightning-button>
                    </div>
                    <h2 class="final-message">La Oportunidad No se encuentra Lista a Facturar</h2>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={calendarEntrega}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card class="c-lightning-card" title="Entregas Disponibles" icon-name="utility:event">
                    <div class="btn-close-modal">
                        <lightning-button label="❌" onclick={closeModal}></lightning-button>
                    </div>
                    <div id="calendar" class="calendar-table">
                        <div>
                            <h2 class="month-year" lwc:dom="manual"></h2>
                        </div>
                        <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
                        <table>
                            <thead id="calendar-body">
                                <tr>
                                    <th>Dom</th>
                                    <th>Lun</th>
                                    <th>Mar</th>
                                    <th>Mie</th>
                                    <th>Jue</th>
                                    <th>Vie</th>
                                    <th>Sab</th>
                                </tr>
                            </thead>
                            <tbody class="calendar-dates" lwc:dom="manual"></tbody>
                        </table>
                        <div id="calendar-header" class="calendar-header">
                            <lightning-button class="prev-month" label="<" onclick={prevMonth}></lightning-button>
                            <lightning-button class="next-month" label=">" onclick={nextMonth}></lightning-button>
                        </div>
                    </div>
                    <div class="content-btn-lower">
                        <lightning-button class="btn-lower" label="Asignar Fecha Entrega"
                            onclick={assignFechaEntrega}></lightning-button>
                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={reasignarCita}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="OP Tiene Cita Asignada" class="lc-listo-facturar-false">
                    <h2 class="final-message">Su Orden de Pedido ya tiene Cita Asignada ¿Desea Reasignarla?</h2>
                    <div class="content-btn-lower">
                        <div>
                            <lightning-button label="Si" onclick={reasignacion} class="btn-lower"></lightning-button>
                            <lightning-button label="No" onclick={closeModal} class="btn-lower"></lightning-button>
                        </div>

                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={calendarArmado}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card class="c-lightning-card" title="Armados Disponibles" icon-name="utility:event">
                    <div id="calendar-armado" class="calendar-table">
                        <div>
                            <h2 class="month-year-armado" lwc:dom="manual"></h2>
                        </div>
                        <table>
                            <thead id="calendar-armado-body">
                                <tr>
                                    <th>Dom</th>
                                    <th>Lun</th>
                                    <th>Mar</th>
                                    <th>Mie</th>
                                    <th>Jue</th>
                                    <th>Vie</th>
                                    <th>Sab</th>
                                </tr>
                            </thead>
                            <tbody class="calendar-dates-armado" lwc:dom="manual"></tbody>
                        </table>
                        <div id="calendar-armado-header" class="calendar-armado-header">
                            <lightning-button class="prev-month" label="<" onclick={prevMonthArmado}></lightning-button>
                            <lightning-button class="next-month" label=">" onclick={nextMonthArmado}></lightning-button>
                        </div>
                    </div>
                    <template if:true={datesArmado}></template>
                    <div class="content-btn-lower">
                        <lightning-button class="btn-lower" label="Asignar Fecha Armado"
                            onclick={assignFechaArmado}></lightning-button>
                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={resumenFinal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="Proceso Concluido Con Exito" icon-name="utility:user" class="final-message">
                    <template lwc:if={firstDelivery}>
                        <div class="calendar-table">
                            <table>
                                <thead id="table-entregas-parciales">
                                    <tr>
                                        <th>Fecha Entrega</th>
                                    </tr>
                                </thead>
                                <tbody class="product-dates">
                                    <tr>
                                        <td>
                                            <p>Primera Entrega: {firstDelivery}</p>
                                            <p>Segunda Entrega: {secondDelivery}</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </template>
                    <template lwc:else>
                        <div class="calendar-table">
                            <table>
                                <thead id="table-result">
                                    <tr>
                                        <th>Fecha Entrega</th>
                                        <th>Fecha Armado</th>
                                    </tr>
                                </thead>
                                <tbody class="product-dates">
                                    <tr>
                                        <td>{datesSelected}</td>
                                        <td>{datesSelectedArmado}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </template>

                    <template if:true={isArmable}>
                        <div class="final-message-armado">Uno de sus productos aplica armado, por favor comuníquese
                            con
                            servicio al cliente 🤖</div>
                    </template>
                    <div class="final-message">Ya puedes Cerrar y tomarte un café 😎</div>
                    <div class="content-btn-lower">
                        <lightning-button label="Cerrar" onclick={refreshPage} class="btn-lower"></lightning-button>
                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={opcionesEntrega}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="Opciones de Entrega" icon-name="utility:cart" class="final-message">
                    <div class="btn-close-modal">
                        <lightning-button label="❌" onclick={closeModal}></lightning-button>
                    </div>
                    <div class="calendar-table">
                        <template if:true={deliveries}>
                            <table>
                                <thead id="opciones-entrega">
                                    <tr>
                                        <th class="td-font-samall">Descripcion</th>
                                        <th class="td-font-samall">Entregas</th>
                                        <th class="td-font-samall">Detalle</th>
                                    </tr>
                                </thead>
                                <tbody class="product-dates">
                                    <template for:each={deliveries} for:item="delivery">
                                        <tr key={delivery.id}>
                                            <td class="td-font-samall">Opcion {delivery.id}</td>
                                            <td class="td-font-samall">
                                                <ol>
                                                    <template for:each={delivery.data} for:item="fecha">
                                                        <li key={fecha}>{fecha.fecha_entrega}</li>
                                                    </template>
                                                </ol>
                                            </td>
                                            <td>
                                                <lightning-button label={delivery.id} onclick={showDetail}
                                                    class="btn-lower"></lightning-button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={detalleEntrega}>
        <template if:true={opcion}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <section class="slds-modal__container">
                    <lightning-card title={opcion.id} icon-name="utility:cart" class="final-message">
                        <div class="calendar-table">
                            <template for:each={opcion.data} for:item="entrega">

                                <table key={entrega.fecha_entrega}>
                                    <thead>
                                        <tr>
                                            <th class="td-font-samall">Codigo</th>
                                            <th class="td-font-samall">Descripcion</th>
                                            <th class="td-font-samall">Cant</th>
                                        </tr>
                                    </thead>
                                    <tbody class="product-dates">
                                        <template for:each={entrega.productos} for:item="producto">
                                            <tr key={producto.sku}>
                                                <td class="td-font-samall">{producto.sku}</td>
                                                <td class="td-align-left">{producto.nom_producto}</td>
                                                <td>{producto.cantidad}</td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                                <div key={entrega.fecha_entrega} class="content-btn-lower-sup">
                                    <lightning-button label={entrega.fecha_entrega}
                                        class="btn-lower"></lightning-button>
                                </div>
                            </template>
                        </div>
                        <div class="content-btn-lower">
                            <lightning-button label="Regresar" onclick={prevScreen}
                                class="btn-lower"></lightning-button>
                            <lightning-button label="Confirmar Entregas" onclick={assignFechaEntregasParciales}
                                class="btn-lower"></lightning-button>
                        </div>
                    </lightning-card>
                </section>
            </section>
            <section class="slds-backdrop slds-backdrop_open"></section>
        </template>
    </template>

    <template if:true={errorEntregasParciales}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="Error" class="lc-listo-facturar-false">
                    <div class="btn-close-modal">
                        <lightning-button label="❌" onclick={closeModal}></lightning-button>
                    </div>
                    <h2 class="final-message">Error al consultar la OP.</h2>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>

    <template if:true={showBtnInit}>
        <lightning-button label="Asignar Cita" onclick={nextScreen}></lightning-button>
    </template>

    <template if:true={reasignarCitaParciales}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <section class="slds-modal__container">
                <lightning-card title="Función en Construcción" class="lc-listo-facturar-false">
                    <h2 class="final-message">OP no puede ser reasignada. Estamos trabajando en una mejora 🤓</h2>
                    <div class="content-btn-lower">
                        <div>
                            <lightning-button label="Cerrar" onclick={closeModal} class="btn-lower"></lightning-button>
                        </div>

                    </div>
                </lightning-card>
            </section>
        </section>
        <section class="slds-backdrop slds-backdrop_open"></section>
    </template>
</template>